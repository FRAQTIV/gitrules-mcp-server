# Git Rules MCP Server

[![npm version](https://img.shields.io/npm/v/@fraqtiv/git-rules-mcp.svg)](https://www.npmjs.com/package/@fraqtiv/git-rules-mcp)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![CI Status](https://github.com/FRAQTIV/gitrules-mcp-server/workflows/CI/badge.svg)](https://github.com/FRAQTIV/gitrules-mcp-server/actions)

**Enforce Git workflow rules and prevent repository violations with AI coding assistants.**

A Model Context Protocol (MCP) server that validates Git commands against configurable repository rules, providing workflow guidance and preventing common Git mistakes when working with AI coding assistants.

---

## üöÄ What It Does

- **üõ°Ô∏è Branch Protection**: Prevents direct commits/pushes to protected branches (main, master, etc.)
- **üìã Workflow Validation**: Validates Git commands against your repository's workflow rules
- **üîÑ Smart Suggestions**: Provides alternative workflows when commands are blocked
- **üìù Commit Standards**: Enforces conventional commit message formats
- **üßπ Repository Health**: Analyzes repository compliance with workflow rules
- **ü§ñ AI Integration**: Works seamlessly with Claude Code, Cursor, GitHub Copilot, and other AI assistants

---

## üéØ Why You Need This

### The Problem
AI coding assistants can accidentally:
- Push directly to protected branches
- Create commits with poor messages
- Bypass your team's Git workflows
- Make repository management chaotic

### The Solution
This MCP server acts as a **gatekeeper** that:
- ‚úÖ **Validates every Git operation** before execution
- ‚úÖ **Enforces your team's workflow rules** consistently  
- ‚úÖ **Guides AI assistants** to follow proper Git practices
- ‚úÖ **Prevents repository violations** before they happen

---

## üì¶ Quick Install

**‚ö†Ô∏è Important**: Most users will encounter permission errors with the default npm configuration. Use the **Recommended Setup** below to avoid issues.

### üéØ Recommended Setup (Prevents Permission Errors)

```bash
# 1. Configure npm to use user directory (avoids permission issues)
mkdir -p ~/.npm-global
npm config set prefix ~/.npm-global

# 2. Add npm global bin to your PATH
echo 'export PATH=~/.npm-global/bin:$PATH' >> ~/.bashrc  # or ~/.zshrc for zsh users
source ~/.bashrc  # or: source ~/.zshrc

# 3. Install the package
npm install -g @fraqtiv/git-rules-mcp

# 4. Verify installation works
mcp-git-rules --test
# ‚úÖ MCP Server: Initialized successfully
# ‚úÖ Git Repository: Detected (or Not found if not in git repo)  
# ‚úÖ Configuration: Loaded (X protected branches)

# 5. Get help and usage information
mcp-git-rules --help
```

### üîß Alternative: System-Wide Install (May Need Sudo)

If you prefer system-wide installation and encounter permission errors:

```bash
# Only if you get EACCES permission errors:
sudo npm install -g @fraqtiv/git-rules-mcp

# Then test (no sudo needed for testing):
mcp-git-rules --test
```

### üö® Quick Fixes for Common Issues

**Still getting permission errors?** Use the Recommended Setup above instead of `npm install -g` directly.

**Command not found after installation?** 
```bash
# Fix PATH - restart terminal after running:
echo 'export PATH="$(npm config get prefix)/bin:$PATH"' >> ~/.zshrc  # or ~/.bashrc
source ~/.zshrc

# Or run with full path:
$(npm config get prefix)/bin/mcp-git-rules --test
```

**Want to check if installed correctly?**
```bash
# Check installation status:
npm list -g @fraqtiv/git-rules-mcp

# Test functionality:
mcp-git-rules --test
```

## ‚ö° Quick Setup by AI Assistant

Choose your AI coding assistant for specific setup instructions:

| Assistant | Integration Guide | Setup Complexity |
|-----------|-------------------|------------------|
| [**Claude Code**](docs/claude-code.md) | Native MCP support with workflow configuration | ‚≠ê‚≠ê‚≠ê |
| [**Cursor**](docs/cursor.md) | MCP + .cursorrules integration | ‚≠ê‚≠ê |
| [**GitHub Copilot**](docs/github-copilot.md) | Bridge extensions + git hooks | ‚≠ê‚≠ê‚≠ê‚≠ê |
| [**KILOCODE**](docs/kilocode.md) | Plugin system integration | ‚≠ê‚≠ê‚≠ê |

> **üí° Quick Start**: Most users should start with the [Claude Code guide](docs/claude-code.md) for the smoothest experience.

---

## üõ†Ô∏è Basic Configuration

Create `.gitrules.yaml` in your repository root:

```yaml
# Protected branches that cannot be directly modified
protectedBranches:
  - main
  - master

# Integration branch where features are merged first  
integrationBranch: dev

# Branch naming conventions
featureBranchPrefix: feature/
hotfixBranchPrefix: hotfix/

# Workflow enforcement
requireCleanWorkingTree: true
allowDirectPush: false
enforceCommitMessageFormat: true

# Conventional commit types
allowedCommitTypes:
  - feat      # New features
  - fix       # Bug fixes  
  - docs      # Documentation
  - style     # Formatting
  - refactor  # Code restructuring
  - test      # Adding tests
  - chore     # Maintenance
```

---

## üéÆ How It Works

### 1. Repository Status Check
```bash
# The MCP server analyzes your repository
Current Branch: feature/user-auth
Status: Clean ‚úÖ
Protected: No ‚úÖ
Integration Branch: dev
```

### 2. Command Validation
```bash
# Before: git push origin main
‚ùå BLOCKED: Direct push to protected branch 'main'
üí° Suggestion: Merge to 'dev' first, then create PR to main

# Proper workflow:
‚úÖ git checkout dev
‚úÖ git merge feature/user-auth  
‚úÖ git push origin dev
‚úÖ Create PR: dev ‚Üí main
```

### 3. Workflow Guidance
```bash
# AI Assistant asks: "How do I start a new feature?"
# MCP Server responds:

üöÄ Starting New Feature:
1. git checkout dev
2. git pull origin dev  
3. git checkout -b feature/your-feature-name

‚úÖ Ready to begin development!
```

---

## üîß Available Tools

The MCP server provides these tools to AI assistants:

| Tool | Purpose | Example Use |
|------|---------|-------------|
| `get_repository_status` | Check branch, cleanliness, protection status | Before any Git operation |
| `validate_git_command` | Validate if a Git command is allowed | Before `push`, `commit`, `merge` |
| `suggest_workflow` | Get step-by-step workflow guidance | Starting features, merging, releases |
| `analyze_repository_compliance` | Full repository health check | Regular compliance audits |

---

## üåü Key Features

### Branch Protection
- **Protected Branches**: Prevent direct commits to main/master
- **Integration Workflow**: Enforce proper merge patterns
- **Clean Working Tree**: Require clean state for protected operations

### Commit Standards  
- **Conventional Commits**: Enforce `type: description` format
- **Type Validation**: Only allow configured commit types
- **Message Quality**: Ensure meaningful commit messages

### Workflow Automation
- **Smart Suggestions**: Alternative paths when commands blocked
- **Step-by-Step Guidance**: Complete workflow instructions  
- **Safety Checks**: Validate before every operation

### AI Assistant Integration
- **Universal Compatibility**: Works with any MCP-enabled AI assistant
- **Real-time Validation**: Immediate feedback on Git operations
- **Educational**: Teaches proper Git workflows

---

## üìñ Example Workflows

### Protected Branch Workflow
```
main (protected) ‚Üê PR ‚Üê dev ‚Üê merge ‚Üê feature/new-auth
                                   ‚Üë
                              You work here
```

### Feature Development Flow
```bash
# 1. Start new feature (validated by MCP)
git checkout dev
git pull origin dev
git checkout -b feature/user-authentication

# 2. Development work
git add .
git commit -m "feat: add user login form"
git commit -m "test: add login form tests"

# 3. Feature complete (validated by MCP)  
git checkout dev
git merge feature/user-authentication
git push origin dev

# 4. Production release
# Create PR: dev ‚Üí main (only way to update main)
```

---

## üèóÔ∏è Advanced Usage

### Custom Rules
```yaml
# .gitrules.yaml - Advanced configuration
protectedBranches:
  - main
  - staging
  - release/*

workflowRules:
  requirePullRequest: true
  requireCodeReview: true
  requireStatusChecks: true
  
branchNaming:
  feature: "feature/JIRA-123-description"
  hotfix: "hotfix/JIRA-456-critical-fix"
  
commitRules:
  maxLength: 72
  requireJiraTicket: true
  allowedScopes: ["auth", "api", "ui", "docs"]
```

### CI/CD Integration
```yaml
# .github/workflows/validate-git-rules.yml
name: Git Rules Validation
on: [push, pull_request]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup npm global directory
        run: |
          mkdir -p ~/.npm-global
          npm config set prefix ~/.npm-global
          echo "$HOME/.npm-global/bin" >> $GITHUB_PATH
      - run: npm install -g @fraqtiv/git-rules-mcp
      - run: mcp-git-rules --test
```

---

## üîç Advanced Troubleshooting

### Installation Issues

**‚ö†Ô∏è Most Common Problems**: See the [Quick Install](#-quick-install) section above for proactive solutions.

**Advanced PATH Configuration**
```bash
# For different shells:
echo 'export PATH="$(npm config get prefix)/bin:$PATH"' >> ~/.bashrc   # Bash
echo 'export PATH="$(npm config get prefix)/bin:$PATH"' >> ~/.zshrc    # Zsh
echo 'set -gx PATH (npm config get prefix)/bin $PATH' >> ~/.config/fish/config.fish  # Fish

# Check current npm prefix:
npm config get prefix

# Check if PATH includes npm global bin:
echo $PATH | grep -q "$(npm config get prefix)/bin" && echo "‚úÖ PATH configured" || echo "‚ùå PATH missing npm global bin"
```

**Package Installation Issues**
```bash
# Check installation
npm list -g @fraqtiv/git-rules-mcp

# Reinstall if needed
npm install -g @fraqtiv/git-rules-mcp
```

**Rules Not Being Enforced**
- See [Claude Code Caveats](docs/claude-code.md#important-caveats)
- Ensure project has proper workflow documentation
- AI assistants need explicit instruction to use MCP tools

**Configuration Not Loading**
```bash
# Test configuration
mcp-git-rules --config-check

# Validate YAML syntax
mcp-git-rules --validate-config .gitrules.yaml
```

---

## ü§ù Contributing

We welcome contributions! Please see our [Contributing Guide](CONTRIBUTING.md) for details.

### Development Setup
```bash
git clone https://github.com/FRAQTIV/gitrules-mcp-server.git
cd gitrules-mcp-server
npm install
npm run build
npm test
```

---

## üìã Roadmap

- [ ] **Web Dashboard** - Visual repository compliance dashboard
- [ ] **Team Analytics** - Workflow compliance metrics and reporting  
- [ ] **Custom Hooks** - Extensible validation system
- [ ] **Integration Templates** - Pre-built configurations for popular workflows
- [ ] **Enterprise Features** - Advanced compliance and audit logging

---

## üìÑ License

MIT License - see [LICENSE](LICENSE) file for details.

---

## üôã Support & Community

- **üìñ Documentation**: [Full docs and integration guides](docs/)
- **üêõ Issues**: [GitHub Issues](https://github.com/FRAQTIV/gitrules-mcp-server/issues)
- **üí¨ Discussions**: [GitHub Discussions](https://github.com/FRAQTIV/gitrules-mcp-server/discussions)
- **üîó Website**: [https://fraqtiv.github.io/gitrules-mcp-server](https://fraqtiv.github.io/gitrules-mcp-server)

---

<div align="center">

**‚≠ê Star this repo if it helps keep your Git workflow clean! ‚≠ê**

Made with ‚ù§Ô∏è by [FRAQTIV](https://github.com/FRAQTIV)

</div>
